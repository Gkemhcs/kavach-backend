{
  "test_cases": [
    {
      "name": "successful_rollback_version",
      "description": "Successfully rollback to a specific version",
      "input": {
        "environment_id": "550e8400-e29b-41d4-a716-446655440000",
        "version_id": "abc12345",
        "commit_message": "Rollback to stable version"
      },
      "expected": {
        "success": true,
        "error": null,
        "secret_version": {
          "id": "def67890",
          "environment_id": "550e8400-e29b-41d4-a716-446655440000",
          "commit_message": "Rollback to stable version",
          "secret_count": 2
        }
      },
      "mock_setup": {
        "secret_repo": [
          {
            "method": "GetSecretVersion",
            "return": {
              "secret_version": {
                "id": "abc12345",
                "environment_id": "550e8400-e29b-41d4-a716-446655440000",
                "commit_message": "Stable version",
                "created_at": "2024-01-01T10:00:00Z"
              },
              "error": null
            }
          },
          {
            "method": "RollbackSecretsToVersion",
            "return": {
              "error": null
            }
          },
          {
            "method": "CreateSecretVersion",
            "return": {
              "secret_version": {
                "id": "def67890",
                "environment_id": "550e8400-e29b-41d4-a716-446655440000",
                "commit_message": "Rollback to stable version",
                "created_at": "2024-01-01T14:00:00Z"
              },
              "error": null
            }
          }
        ]
      }
    },
    {
      "name": "version_not_found_error",
      "description": "Fail when target version does not exist",
      "input": {
        "environment_id": "550e8400-e29b-41d4-a716-446655440000",
        "version_id": "nonexistent",
        "commit_message": "Rollback to non-existent version"
      },
      "expected": {
        "success": false,
        "error": "version not found"
      },
      "mock_setup": {
        "secret_repo": [
          {
            "method": "GetSecretVersion",
            "return": {
              "error": "sql: no rows in result set"
            }
          }
        ]
      }
    },
    {
      "name": "invalid_environment_id_error",
      "description": "Fail when environment ID is invalid",
      "input": {
        "environment_id": "invalid-uuid",
        "version_id": "abc12345",
        "commit_message": "Rollback test"
      },
      "expected": {
        "success": false,
        "error": "invalid UUID length"
      },
      "mock_setup": {}
    },
    {
      "name": "database_error_on_rollback",
      "description": "Fail when database error occurs during rollback",
      "input": {
        "environment_id": "550e8400-e29b-41d4-a716-446655440000",
        "version_id": "abc12345",
        "commit_message": "Rollback test"
      },
      "expected": {
        "success": false,
        "error": "failed to rollback secrets"
      },
      "mock_setup": {
        "secret_repo": [
          {
            "method": "GetSecretVersion",
            "return": {
              "secret_version": {
                "id": "abc12345",
                "environment_id": "550e8400-e29b-41d4-a716-446655440000",
                "commit_message": "Stable version",
                "created_at": "2024-01-01T10:00:00Z"
              },
              "error": null
            }
          },
          {
            "method": "RollbackSecretsToVersion",
            "return": {
              "error": "database connection failed"
            }
          }
        ]
      }
    },
    {
      "name": "database_error_on_version_creation",
      "description": "Fail when database error occurs during new version creation",
      "input": {
        "environment_id": "550e8400-e29b-41d4-a716-446655440000",
        "version_id": "abc12345",
        "commit_message": "Rollback test"
      },
      "expected": {
        "success": false,
        "error": "failed to create rollback version"
      },
      "mock_setup": {
        "secret_repo": [
          {
            "method": "GetSecretVersion",
            "return": {
              "secret_version": {
                "id": "abc12345",
                "environment_id": "550e8400-e29b-41d4-a716-446655440000",
                "commit_message": "Stable version",
                "created_at": "2024-01-01T10:00:00Z"
              },
              "error": null
            }
          },
          {
            "method": "RollbackSecretsToVersion",
            "return": {
              "error": null
            }
          },
          {
            "method": "CreateSecretVersion",
            "return": {
              "error": "database connection failed"
            }
          }
        ]
      }
    },
    {
      "name": "missing_commit_message_error",
      "description": "Fail when commit message is empty",
      "input": {
        "environment_id": "550e8400-e29b-41d4-a716-446655440000",
        "version_id": "abc12345",
        "commit_message": ""
      },
      "expected": {
        "success": false,
        "error": "commit message is required"
      },
      "mock_setup": {}
    },
    {
      "name": "empty_version_id_error",
      "description": "Fail when version ID is empty",
      "input": {
        "environment_id": "550e8400-e29b-41d4-a716-446655440000",
        "version_id": "",
        "commit_message": "Rollback test"
      },
      "expected": {
        "success": false,
        "error": "version ID is required"
      },
      "mock_setup": {}
    }
  ]
} 